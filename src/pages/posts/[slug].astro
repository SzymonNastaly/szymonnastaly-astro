---
import { Image } from 'astro:assets';
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { formatDate } from '../../lib/utils';

export async function getStaticPaths() {
  const posts = await getCollection('posts', ({ data }) => !data.draft);
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<Layout title={post.data.title}>
  <article>
    <header class="mb-10">
      <h1 class="text-3xl md:text-4xl font-semibold leading-tight mb-4 text-charcoal">
        {post.data.title}
      </h1>
      <time datetime={post.data.date.toISOString()} class="text-sm text-muted">
        {formatDate(post.data.date)}
      </time>
    </header>

    {post.data.featured && (
      <Image
        src={post.data.featured}
        alt={post.data.featuredAlt}
        width={720}
        height={400}
        class="w-full h-auto rounded-lg mb-10 shadow-sm"
      />
    )}

    <div class="prose-warm">
      <Content />
    </div>

    <footer class="mt-12 pt-8 border-t border-border">
      <a
        href="/"
        class="text-terracotta hover:text-terracotta-dark no-underline font-medium inline-flex items-center gap-1"
      >
        <span>&larr;</span>
        <span>Back to all posts</span>
      </a>
    </footer>
  </article>
</Layout>
